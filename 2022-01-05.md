# Dev Log 2022-01-05

## PostGIS In Action

Today I only got through a few pages.  I learned a lot more about postgres than I did about postgis which is great.

- I learned serial means auto increment
- I learned that gist in general is the preferred index for spatial indexes
- I learend how to add a foreign key in postgres

I only got through 5 pages in 20 minutes but that's ok.  All things worth while take time.  Even 5 pages a day means that I will get through the book in a 112 which is not bad!!

```sql

-- create an populate the table lu_franchises

create table ch01.lu_franchises (id char(3) primary key, franchise varchar(30));

insert into ch01.lu_franchises (id, franchise) VALUES
('BKG', 'Burger King'), ('CJR', 'Carl''s Jr'),
('HDE', 'Hardee'), ('INO', 'In-N-Out'),
('JIB', 'Jack in the Box'), ('KFC', 'Kentucky Fried Chicken'),
('MCD', 'McDonald'), ('PZH', 'Pizza Hut'),
('TCB', 'Taco Bell'), ('WDY', 'Wendys');


-- create an populate the table restaurants
-- In postgres serial is the same as auto increment
create table ch01.restaurants (
id serial primary key, 
franchise char(3) not null,
geom geometry(point, 2163) -- This second is the SRID which identifies the type of map
)

-- This adds a spatial index to queries to make them faster
-- There are three kinds of spatial index but gist is usually the one you want to use.

create index ix_code_restuarant_geom on ch01.restaurants  using gist(geom);

-- Creates a foriegn key constraint

alter table ch01.restaurants 
add constraint fk_restuarant_lu_franchises
foreign key (franchise)
references ch01.lu_franchises (id)
on update cascade on delete restrict;

-- puts an index on the foriegn key

create index fi_restaurant_franchise on ch01.restaurants  (franchise)

-- creates the highway table
-- varying is the same as varchar
-- 
create table ch01.highways (
gid integer not null,
feature character varying(80),
name character varying(120),
state character varying(2),
geom geometry (multilinestring, 2163), -- notice we are using multi lines and not points
constraint pk_highways primary key (gid)
)

-- puts the index on the multi line string
create index ix_highways on ch01.highways using gist(geom);
```
